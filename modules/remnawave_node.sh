#!/bin/bash
# ============================================================ #
# ==             –ú–û–î–£–õ–¨ REMNAWAVE: –ù–û–î–´ –ò SKYNET             == #
# ============================================================ #
#
# –£–ø—Ä–∞–≤–ª—è–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –Ω–æ–¥ Remnawave:
#  - –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —ç—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä;
#  - —É–¥–∞–ª—ë–Ω–Ω–æ —á–µ—Ä–µ–∑ Skynet (–æ–¥–Ω–∞ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–æ–¥).
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç HTTP API –ø–∞–Ω–µ–ª–∏ –∏ Skynet-–ø–ª–∞–≥–∏–Ω—ã.
#
[[ "${BASH_SOURCE[0]}" == "${0}" ]] && exit 1

# === –í–ù–£–¢–†–ï–ù–ù–ò–ï –•–ï–õ–ü–ï–†–´ (–±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ –ø–ª–∞–Ω—É) =========

_remna_node_install_local_wizard() {
    clear
    menu_header "–ù–æ–¥–∞ Remnawave –Ω–∞ —ç—Ç–æ—Ç —Å–µ—Ä–≤–∞–∫"
    echo
    echo "   –°—Ç–∞–≤–∏–º –ù–û–î–£ –¥–ª—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–∞–Ω–µ–ª–∏."
    echo "   –ü–∞–Ω–µ–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç—É—Ç –∏–ª–∏ –Ω–∞ –¥—Ä—É–≥–æ–º —Å–µ—Ä–≤–µ—Ä–µ."
    echo

    local PANEL_API HOST SELFSTEAL_DOMAIN NODE_NAME
    PANEL_API=$(safe_read "API –ø–∞–Ω–µ–ª–∏ (host:port, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 127.0.0.1:3000): " "127.0.0.1:3000")
    SELFSTEAL_DOMAIN=$(safe_read "Selfsteal –¥–æ–º–µ–Ω –Ω–æ–¥—ã (node.example.com): " "")
    NODE_NAME=$(safe_read "–ò–º—è –Ω–æ–¥—ã –≤ –ø–∞–Ω–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä Germany-1): " "")

    if [[ -z "$SELFSTEAL_DOMAIN" || -z "$NODE_NAME" ]]; then
        err "–ò–º—è –Ω–æ–¥—ã –∏ –¥–æ–º–µ–Ω ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ."
        return 1
    fi

    info "–ö–∞—Ä–∫–∞—Å –ª–æ–∫–∞–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–æ–¥—ã –≥–æ—Ç–æ–≤. –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –µ—â—ë –Ω–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞."
    wait_for_enter
}

_remna_node_install_skynet_one() {
    clear
    menu_header "–ù–æ–¥–∞ Remnawave —á–µ—Ä–µ–∑ Skynet (–æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä)"
    echo
    echo "   –¢—É—Ç –≤—ã–±–µ—Ä–µ–º –æ–¥–∏–Ω —Å–µ—Ä–≤–∞–∫ –∏–∑ —Ñ–ª–æ—Ç–∞ –∏ –≤–æ—Ç–∫–Ω—ë–º —Ç—É–¥–∞ –Ω–æ–¥—É."
    echo
    warn "–ü–æ–∫–∞ —Ç–æ–ª—å–∫–æ –∫–∞—Ä–∫–∞—Å. –í—ã–±–æ—Ä —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∑–∞–ø—É—Å–∫ –ø–ª–∞–≥–∏–Ω–∞ –µ—â—ë –≤–ø–µ—Ä–µ–¥–∏."
    wait_for_enter
}

_remna_node_install_skynet_many() {
    clear
    menu_header "–ù–æ–¥—ã Remnawave —á–µ—Ä–µ–∑ Skynet (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤)"
    echo
    echo "   –†–∞–∑–¥–∞—ë–º –Ω–æ–¥—ã –ø–∞—á–∫–æ–π –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–∞–º Skynet."
    echo
    warn "–ü–æ–∫–∞ —Ç–æ–ª—å–∫–æ –∫–∞—Ä–∫–∞—Å. –ú–∞—Å—Å–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –µ—â—ë –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞."
    wait_for_enter
}

# === –ú–ï–ù–Æ –ú–û–î–£–õ–Ø =============================================

show_remnawave_node_menu() {
    while true; do
        clear
        menu_header "–ù–æ–¥—ã Remnawave (–ª–æ–∫–∞–ª—å–Ω–æ –∏ —á–µ—Ä–µ–∑ Skynet)"
        echo
        echo "   [1] –ü–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–¥—É –Ω–∞ –≠–¢–û–¢ —Å–µ—Ä–≤–µ—Ä"
        echo "   [2] –ü–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–¥—É —á–µ—Ä–µ–∑ Skynet –Ω–∞ –û–î–ò–ù —Å–µ—Ä–≤–µ—Ä"
        echo "   [3] –†–∞–∑–¥–∞—Ç—å –Ω–æ–¥—ã —á–µ—Ä–µ–∑ Skynet –Ω–∞ –ù–ï–°–ö–û–õ–¨–ö–û —Å–µ—Ä–≤–∞–∫–æ–≤"
        echo
        echo "   [b] üîô –ù–∞–∑–∞–¥"
        echo "------------------------------------------------------"

        local choice
        choice=$(safe_read "–¢–≤–æ–π –≤—ã–±–æ—Ä: " "")

        case "$choice" in
            1) _remna_node_install_local_wizard ;;
            2) _remna_node_install_skynet_one ;;
            3) _remna_node_install_skynet_many ;;
            [bB]) break ;;
            *) err "–ù–µ—Ç —Ç–∞–∫–æ–≥–æ –ø—É–Ω–∫—Ç–∞, —Å–º–æ—Ç—Ä–∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–µ–µ, –±–æ—Å—Å." ;;
        esac
    done
}
