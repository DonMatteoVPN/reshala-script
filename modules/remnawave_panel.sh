#!/bin/bash
# ============================================================ #
# ==             –ú–û–î–£–õ–¨ REMNAWAVE: –¢–û–õ–¨–ö–û –ü–ê–ù–ï–õ–¨             == #
# ============================================================ #
#
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–∞–Ω–µ–ª—å Remnawave –Ω–∞ —ç—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä
# (–±–µ–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –Ω–æ–¥—ã), –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –µ—ë —á–µ—Ä–µ–∑ HTTP API –∏
# –≥–æ—Ç–æ–≤–∏—Ç –±–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –±—É–¥—É—â–∏—Ö –Ω–æ–¥.
#
[[ "${BASH_SOURCE[0]}" == "${0}" ]] && exit 1

# === –í–ù–£–¢–†–ï–ù–ù–ò–ï –•–ï–õ–ü–ï–†–´ (–∑–∞–ø–æ–ª–Ω–∏–º –ø–æ –ø–ª–∞–Ω—É –ø–æ–∑–∂–µ) ============

_remna_panel_install_wizard() {
    clear
    menu_header "Remnawave: —Ç–æ–ª—å–∫–æ –ø–∞–Ω–µ–ª—å"
    echo
    echo "   –°—Ç–∞–≤–∏–º —Ç–æ–ª—å–∫–æ –ø–∞–Ω–µ–ª—å, –Ω–æ–¥—ã –ø–æ—Ç–æ–º –º–æ–∂–Ω–æ —Ä–∞—Å–∫–∏–¥–∞—Ç—å —á–µ—Ä–µ–∑ Skynet."
    echo

    local PANEL_DOMAIN SUB_DOMAIN SUPERADMIN_USERNAME
    PANEL_DOMAIN=$(safe_read "–î–æ–º–µ–Ω –ø–∞–Ω–µ–ª–∏ (panel.example.com): " "")
    SUB_DOMAIN=$(safe_read "–î–æ–º–µ–Ω –ø–æ–¥–ø–∏—Å–∫–∏ (sub.example.com): " "")
    SUPERADMIN_USERNAME=$(safe_read "–õ–æ–≥–∏–Ω —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∞ –ø–∞–Ω–µ–ª–∏: " "boss")

    if [[ -z "$PANEL_DOMAIN" || -z "$SUB_DOMAIN" ]]; then
        err "–ë–µ–∑ –¥–æ–º–µ–Ω–æ–≤ –ø–∞–Ω–µ–ª–∏ –∏ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∏–∫—É–¥–∞."
        return 1
    fi
    if [[ "$PANEL_DOMAIN" == "$SUB_DOMAIN" ]]; then
        err "–î–æ–º–µ–Ω –ø–∞–Ω–µ–ª–∏ –∏ –ø–æ–¥–ø–∏—Å–∫–∏ –¥–æ–ª–∂–Ω—ã –æ—Ç–ª–∏—á–∞—Ç—å—Å—è."
        return 1
    fi

    info "–ö–∞—Ä–∫–∞—Å –º–∞—Å—Ç–µ—Ä–∞ –ø–∞–Ω–µ–ª–∏ –≥–æ—Ç–æ–≤. –¢—è–∂—ë–ª–∞—è –ª–æ–≥–∏–∫–∞ –∏–∑ –¥–æ–Ω–æ—Ä–∞ –µ—â—ë –Ω–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞."
    wait_for_enter
}

# === –ú–ï–ù–Æ –ú–û–î–£–õ–Ø =============================================

show_remnawave_panel_menu() {
    while true; do
        clear
        menu_header "Remnawave: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–Ω–µ–ª–∏"
        echo
        echo "   [1] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–Ω–µ–ª—å –Ω–∞ —ç—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä"
        echo "   [2] (WIP) –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –ø–∞–Ω–µ–ª—å—é"
        echo
        echo "   [b] üîô –ù–∞–∑–∞–¥"
        echo "------------------------------------------------------"

        local choice
        choice=$(safe_read "–¢–≤–æ–π –≤—ã–±–æ—Ä: " "")

        case "$choice" in
            1) _remna_panel_install_wizard ;;
            2) warn "–ú–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–Ω–µ–ª—å—é –µ—â—ë –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ."; sleep 2 ;;
            [bB]) break ;;
            *) err "–ù–µ—Ç —Ç–∞–∫–æ–≥–æ –ø—É–Ω–∫—Ç–∞, —Å–º–æ—Ç—Ä–∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–µ–µ, –±–æ—Å—Å." ;;
        esac
    done
}
